<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sudoku</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,[%3Csvg fill='%23000000' height='100px' width='100px' version='1.1' id='Capa_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 445.049 445.049' xml:space='preserve'%3E%3Cpath id='XMLID_176_' d='M56.507,73.548c-3.393-3.632-3.2-9.327,0.433-12.72l26.938-25.166c2.619-2.447,6.44-3.106,9.729-1.679 c3.288,1.428,5.415,4.67,5.415,8.255v70.863c0,4.971-4.029,9-9,9s-9-4.029-9-9V62.963L69.228,73.98 C65.595,77.374,59.9,77.181,56.507,73.548z M437.533,9v170.012c0,4.971-4.029,9-9,9s-9-4.029-9-9v-23.673H300.193v119.338h25.329 c4.971,0,9,4.029,9,9s-4.029,9-9,9h-25.329v119.338h25.329c4.971,0,9,4.029,9,9s-4.029,9-9,9h-34.138 c-0.063,0.001-0.127,0.002-0.191,0.002c-0.063,0-0.127-0.001-0.191-0.002H154.048c-0.125,0.003-0.254,0.003-0.382,0H16.546 c-4.97,0-9-4.029-9-8.999L7.536,284.28c-0.013-0.2-0.02-0.4-0.02-0.604c0-0.202,0.007-0.402,0.02-0.602l-0.01-136.31 c-0.006-0.142-0.01-0.283-0.01-0.427c0-0.143,0.003-0.284,0.01-0.426L7.516,9.001c0-2.388,0.948-4.677,2.636-6.364 C11.84,0.948,14.129,0,16.516,0h412.017C433.503,0,437.533,4.029,437.533,9z M144.857,292.677H25.537l0.009,119.338h119.312V292.677 z M144.857,155.339H25.527l0.008,119.338h119.322V155.339z M144.857,18H25.517l0.009,119.339h119.332V18z M282.193,292.677H162.857 v119.338h119.336V292.677z M282.193,155.339H162.857v119.338h119.336V155.339z M282.193,18H162.857v119.339h119.336V18z M419.533,18 H300.193v119.339h119.339V18z M435.378,231.685c1.39,1.629,2.154,3.701,2.154,5.843v198.521c0,4.971-4.029,9-9,9H371.8 c-4.971,0-9-4.029-9-9V237.527c0-2.142,0.764-4.214,2.154-5.843l28.366-33.234c1.71-2.004,4.212-3.157,6.846-3.157 s5.136,1.153,6.846,3.157L435.378,231.685z M419.533,408.026H380.8v19.022h38.733V408.026z M419.533,261.238H380.8v128.788h38.733 V261.238z M419.533,240.846l-19.367-22.689L380.8,240.846v2.393h38.733V240.846z M238.798,238.695H189.91c-4.971,0-9,4.029-9,9 s4.029,9,9,9h48.888c13.974,0,25.342-11.369,25.342-25.344c0-6.223-2.254-11.928-5.988-16.344 c3.734-4.416,5.988-10.121,5.988-16.344c0-13.975-11.369-25.344-25.342-25.344H189.91c-4.971,0-9,4.029-9,9s4.029,9,9,9h48.888 c4.048,0,7.342,3.295,7.342,7.345c0,4.049-3.294,7.343-7.342,7.343h-28.77c-4.971,0-9,4.029-9,9s4.029,9,9,9h28.77 c4.048,0,7.342,3.295,7.342,7.345C246.14,235.401,242.846,238.695,238.798,238.695z'/%3E%3C/svg%3E]"
    />
    <style>
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }
      .alternate {
        background-color: #ddd;
      }

      .alternate input {
        background-color: #ddd;
      }

      /* New CSS to center the Sudoku grid and buttons */
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      table {
        max-width: 90vw;
        max-height: 90vh;
        width: auto;
        height: auto;
      }
      button {
        font-family: "Courier New", monospace;
        background-color: #ffffff;
        border: 1px solid #000000;
        color: #000000;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        transition-duration: 0.4s;
      }
      button:hover {
        background-color: #000000;
        color: #ffffff;
      }
      #toptext {
        font-family: "Courier New", Courier, monospace;
        font-size: 2vh;
        margin-bottom: 20px;
        text-align: center;
      }
      input {
        width: 2em;
        height: 2em;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- Sudoku grid -->
    <span id="toptext">
      Start by entering the numbers in the grid. Then click the Solve Sudoku
      button to solve the Sudoku. 0 represents an empty cell.
    </span>

    <table id="sudoku"></table>
    <button id="solve">Solve Sudoku</button>
    <button id="clear">Clear Grid</button>
    <script>
      // JavaScript code for generating the Sudoku grid, solving the Sudoku, and clearing the grid

      /**
       * Generates the Sudoku grid and adds it to the HTML table.
       */
      const table = document.getElementById("sudoku");
      for (let i = 0; i < 9; i++) {
        const row = document.createElement("tr");
        for (let j = 0; j < 9; j++) {
          const cell = document.createElement("td");
          const input = document.createElement("input");
          input.type = "number";
          input.min = 1;
          input.max = 9;
          input.id = `cell-${i}-${j}`; // Assign an ID to the input element

          // Add event listener
          input.addEventListener("input", function () {
            if (input.value > 9) {
              input.value = ""; // Clear the input field if the user enters a number greater than 9
            } else if (input.value == 0) {
              input.value = ""; // Clear the input field if the user enters 0
            }
            if (input.value !== "") {
              let nextCell;
              if (j < 8) {
                // If it's not the last cell in the row
                nextCell = document.getElementById(`cell-${i}-${j + 1}`);
              } else if (i < 8) {
                // If it's not the last row
                nextCell = document.getElementById(`cell-${i + 1}-0`);
              }
              if (nextCell) {
                nextCell.focus();
              }
            }
          });
          input.addEventListener("keydown", function (event) {
            if (event.key === "Backspace" && input.value === "") {
              let previousCell;
              if (j > 0) {
                // If it's not the first cell in the row
                previousCell = document.getElementById(`cell-${i}-${j - 1}`);
              } else if (i > 0) {
                // If it's not the first row
                previousCell = document.getElementById(`cell-${i - 1}-8`);
              }
              if (previousCell) {
                previousCell.focus();
              }
              event.preventDefault(); // Prevent the default action
            }
          });
          cell.appendChild(input);
          if (Math.floor(i / 3) % 2 === Math.floor(j / 3) % 2) {
            cell.classList.add("alternate");
          }
          row.appendChild(cell);
        }
        table.appendChild(row);
      }
      // Set focus to the first input field when the webpage loads
      document.getElementById("cell-0-0").focus();
      document.getElementById("solve").addEventListener("click", function () {
        const grid = [];
        for (let i = 0; i < 9; i++) {
          const row = [];
          for (let j = 0; j < 9; j++) {
            const value = document.getElementById(`cell-${i}-${j}`).value;
            row.push(value ? parseInt(value, 10) : 0);
          }
          grid.push(row);
        }

        if (!isValidSudoku(grid)) {
          alert("The Sudoku is not valid");
          return;
        }

        if (solveSudoku(grid)) {
          for (let i = 0; i < 9; i++) {
            for (let j = 0; j < 9; j++) {
              document.getElementById(`cell-${i}-${j}`).value = grid[i][j];
            }
          }
        } else {
          alert("The Sudoku cannot be solved");
        }
      });

      function isValidSudoku(grid) {
        for (let i = 0; i < 9; i++) {
          const row = new Set();
          const col = new Set();
          const box = new Set();

          for (let j = 0; j < 9; j++) {
            if (grid[i][j] !== 0) {
              if (row.has(grid[i][j])) {
                return false;
              }
              row.add(grid[i][j]);
            }

            if (grid[j][i] !== 0) {
              if (col.has(grid[j][i])) {
                return false;
              }
              col.add(grid[j][i]);
            }

            const boxRow = 3 * Math.floor(i / 3) + Math.floor(j / 3);
            const boxCol = 3 * (i % 3) + (j % 3);
            if (grid[boxRow][boxCol] !== 0) {
              if (box.has(grid[boxRow][boxCol])) {
                return false;
              }
              box.add(grid[boxRow][boxCol]);
            }
          }
        }

        return true;
      }

      function solveSudoku(grid, row = 0, col = 0) {
        if (row === 9) {
          return true;
        }

        if (col === 9) {
          return solveSudoku(grid, row + 1, 0);
        }

        if (grid[row][col] !== 0) {
          return solveSudoku(grid, row, col + 1);
        }

        for (let num = 1; num <= 9; num++) {
          if (isValid(grid, row, col, num)) {
            grid[row][col] = num;

            if (solveSudoku(grid, row, col + 1)) {
              return true;
            }

            grid[row][col] = 0;
          }
        }

        return false;
      }

      function isValid(grid, row, col, num) {
        for (let i = 0; i < 9; i++) {
          if (grid[i][col] === num) {
            return false;
          }

          if (grid[row][i] === num) {
            return false;
          }

          if (
            grid[3 * Math.floor(row / 3) + Math.floor(i / 3)][
              3 * Math.floor(col / 3) + (i % 3)
            ] === num
          ) {
            return false;
          }
        }

        return true;
      }
      document.getElementById("clear").addEventListener("click", function () {
        for (let i = 0; i < 9; i++) {
          for (let j = 0; j < 9; j++) {
            document.getElementById(`cell-${i}-${j}`).value = "";
          }
        }
        document.getElementById("cell-0-0").focus();
      });
    </script>
  </body>
</html>
